# é¡¹ç›®å½“å‰è¿›åº¦

**æœ€åæ›´æ–°**: 2025-10-04

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. AI å›¾ç‰‡ç”Ÿæˆæ ¸å¿ƒåŠŸèƒ½
- âœ… **Seedream 4.0 é›†æˆ**
  - æ–‡ç”Ÿå›¾ (Text-to-Image)
  - å›¾ç”Ÿå›¾ (Image-to-Image)
  - æ”¯æŒç»„å›¾ç”Ÿæˆæ¨¡å¼ (Sequential Generation)
  - å®Œæ•´å‚æ•°é…ç½®ï¼šåˆ†è¾¨ç‡ã€å®½é«˜æ¯”ã€ç”Ÿæˆæ•°é‡ç­‰

- âœ… **Nano Banana é›†æˆ**
  - æ–‡ç”Ÿå›¾ (Text-to-Image)
  - å›¾ç”Ÿå›¾ (Image-to-Image)
  - å‚æ•°é…ç½®ï¼šç”Ÿæˆæ•°é‡ã€è¾“å‡ºæ ¼å¼ã€å®½é«˜æ¯”ç­‰

### 2. API è·¯ç”±
**åç«¯ API è·¯ç”± (4ä¸ª):**
- `/api/predictions/seedream-text-to-image` - Seedream æ–‡ç”Ÿå›¾
- `/api/predictions/seedream-image-to-image` - Seedream å›¾ç”Ÿå›¾
- `/api/predictions/nanobanana-text-to-image` - Nano Banana æ–‡ç”Ÿå›¾
- `/api/predictions/nanobanana-image-to-image` - Nano Banana å›¾ç”Ÿå›¾

**æŸ¥è¯¢ç«¯ç‚¹ (2ä¸ª):**
- `/api/predictions/seedream/[predictionId]` - Seedream ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
- `/api/predictions/nanobanana/[requestId]` - Nano Banana ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢

### 3. å‰ç«¯ UI
- âœ… **æ¨¡å‹é€‰æ‹©ç•Œé¢** - æ”¯æŒåˆ‡æ¢ Seedream å’Œ Nano Banana
- âœ… **ç”Ÿæˆæ¨¡å¼åˆ‡æ¢** - æ–‡ç”Ÿå›¾ / å›¾ç”Ÿå›¾æ¨¡å¼åˆ‡æ¢
- âœ… **å‚æ•°é…ç½®é¢æ¿**
  - Seedream: åˆ†è¾¨ç‡ã€å®½é«˜æ¯”ã€ç»„å›¾æ¨¡å¼ã€æœ€å¤§æ•°é‡
  - Nano Banana: ç”Ÿæˆæ•°é‡ã€è¾“å‡ºæ ¼å¼ã€å®½é«˜æ¯”
  - å›¾ç”Ÿå›¾æ¨¡å¼å‚æ•°è‡ªåŠ¨é€‚é…
- âœ… **å¤šå›¾ç½‘æ ¼å±•ç¤º**
  - å“åº”å¼ç½‘æ ¼å¸ƒå±€ï¼ˆ1-4åˆ—ï¼‰
  - å›¾ç‰‡åºå·æ ‡ç­¾
  - æ‚¬åœæ•ˆæœå’Œä¸‹è½½æŒ‰é’®
  - ç‚¹å‡»æ”¾å¤§é¢„è§ˆ
  - æ‰¹é‡ä¸‹è½½åŠŸèƒ½

### 4. äº‘é›¾ API é›†æˆ
- âœ… **ç»Ÿä¸€ API å°è£…** ([src/backend/utils/yunwu.ts](src/backend/utils/yunwu.ts))
  - `createSeedreamTask()` - Seedream ä»»åŠ¡åˆ›å»º
  - `createNanoBananaTask()` - Nano Banana æ–‡ç”Ÿå›¾
  - `createNanoBananaEditTask()` - Nano Banana å›¾ç”Ÿå›¾
- âœ… **æŸ¥è¯¢æ¥å£é€‚é…**
  - Seedream: Replicate å…¼å®¹æ ¼å¼
  - Nano Banana: Fal.ai å…¼å®¹æ ¼å¼
  - ç»Ÿä¸€çŠ¶æ€è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼

### 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… **é”™è¯¯å¤„ç†** - 404 ç­‰é”™è¯¯ä¼˜é›…é™çº§ä¸º processing çŠ¶æ€
- âœ… **è½®è¯¢æœºåˆ¶** - 2ç§’é—´éš”è‡ªåŠ¨æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
- âœ… **åŠ è½½çŠ¶æ€** - å‡†å¤‡ä¸­/ç”Ÿæˆä¸­çŠ¶æ€æç¤º
- âœ… **æ·±è‰²ä¸»é¢˜** - Select ç»„ä»¶æ ·å¼ä¿®å¤
- âœ… **ç§¯åˆ†ç³»ç»Ÿ** - ç”Ÿæˆå‰æ£€æŸ¥ç§¯åˆ†ï¼Œå®Œæˆåæ‰£é™¤

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ app/api/predictions/
â”‚   â”œâ”€â”€ seedream-text-to-image/route.ts      # Seedream æ–‡ç”Ÿå›¾ API
â”‚   â”œâ”€â”€ seedream-image-to-image/route.ts     # Seedream å›¾ç”Ÿå›¾ API
â”‚   â”œâ”€â”€ nanobanana-text-to-image/route.ts    # Nano Banana æ–‡ç”Ÿå›¾ API
â”‚   â”œâ”€â”€ nanobanana-image-to-image/route.ts   # Nano Banana å›¾ç”Ÿå›¾ API
â”‚   â”œâ”€â”€ seedream/[predictionId]/route.ts     # Seedream æŸ¥è¯¢ API
â”‚   â””â”€â”€ nanobanana/[requestId]/route.ts      # Nano Banana æŸ¥è¯¢ API
â”œâ”€â”€ backend/utils/
â”‚   â””â”€â”€ yunwu.ts                              # äº‘é›¾ API å°è£…
â”œâ”€â”€ components/replicate/text-to-image/
â”‚   â”œâ”€â”€ worker.tsx                            # ä¸»æ§ç»„ä»¶ï¼ˆå‚æ•°é…ç½®ã€ç”Ÿæˆé€»è¾‘ï¼‰
â”‚   â””â”€â”€ img-output.tsx                        # å¤šå›¾ç½‘æ ¼å±•ç¤ºç»„ä»¶
â””â”€â”€ app/globals.css                           # æ·±è‰²ä¸»é¢˜æ ·å¼

.env:
  YUNWU_API_TOKEN=xxx                         # äº‘é›¾ API Token
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### API å‚æ•°æ˜ å°„

**Seedream 4.0:**
```typescript
{
  prompt: string,                    // å¿…å¡«
  size: "1K" | "2K" | "4K",         // é»˜è®¤ 2K
  aspect_ratio: "1:1" | "4:3" | ..., // é»˜è®¤ 1:1 (æ–‡ç”Ÿå›¾) / match_input_image (å›¾ç”Ÿå›¾)
  sequential_image_generation: "disabled" | "auto",
  max_images: 1-15,                  // ä»… auto æ¨¡å¼
  image_input?: string[]             // å›¾ç”Ÿå›¾æ—¶å¿…å¡«ï¼Œ1-10å¼ 
}
```

**Nano Banana:**
```typescript
{
  prompt: string,                    // å¿…å¡«
  num_images: 1-4,                   // é»˜è®¤ 1
  output_format: "jpeg" | "png",     // é»˜è®¤ jpeg
  aspect_ratio: "1:1" | "4:3" | ..., // é»˜è®¤ 1:1
  sync_mode: false,
  image_urls?: string[]              // å›¾ç”Ÿå›¾æ—¶å¿…å¡«
}
```

### æ•°æ®åº“å­—æ®µ

**effect_result è¡¨å…³é”®å­—æ®µ:**
- `storage_type: "yunwu"` - æ ‡è¯†ä½¿ç”¨äº‘é›¾ API
- `original_id` - ä»»åŠ¡ ID (prediction_id æˆ– request_id)
- `status` - succeeded/failed/processing
- `url` - æœ€ç»ˆå­˜å‚¨çš„å›¾ç‰‡ URLï¼ˆå¦‚æœå¯ç”¨ R2ï¼‰

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

1. **å›¾ç‰‡å­˜å‚¨**: å½“å‰ç›´æ¥ä½¿ç”¨äº‘é›¾è¿”å›çš„ URLï¼Œæœªå®ç°ä¸Šä¼ åˆ° R2/S3
2. **Webhook**: æœ¬åœ°å¼€å‘ç¯å¢ƒæœªå¯ç”¨ webhookï¼ˆä¾èµ–è½®è¯¢ï¼‰
3. **å¤šå›¾ä¸‹è½½**: æ‰¹é‡ä¸‹è½½æœ‰500mså»¶è¿Ÿï¼Œé¿å…æµè§ˆå™¨é˜»æ­¢

## ğŸ“Š æµ‹è¯•çŠ¶æ€

- âœ… Seedream æ–‡ç”Ÿå›¾ - æ­£å¸¸å·¥ä½œ
- âœ… Seedream å›¾ç”Ÿå›¾ - å¾…æµ‹è¯•
- âœ… Nano Banana æ–‡ç”Ÿå›¾ - å¾…æµ‹è¯•
- âœ… Nano Banana å›¾ç”Ÿå›¾ - å¾…æµ‹è¯•
- âœ… ç»„å›¾æ¨¡å¼ï¼ˆautoï¼‰- 14å¼ å›¾ç‰‡æˆåŠŸæ˜¾ç¤º
- âœ… å‚æ•°é…ç½® - æ‰€æœ‰å‚æ•°æ­£ç¡®ä¼ é€’
- âœ… å¤šå›¾å±•ç¤º - ç½‘æ ¼å¸ƒå±€æ­£å¸¸

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§ 1: æ ¸å¿ƒåŠŸèƒ½å®Œå–„
1. **R2/S3 å­˜å‚¨é›†æˆ**
   - å°†äº‘é›¾è¿”å›çš„å›¾ç‰‡ä¸Šä¼ åˆ° R2/S3
   - æ›´æ–° `effect_result.url` å­—æ®µ
   - å®ç°å›¾ç‰‡æŒä¹…åŒ–å­˜å‚¨

2. **webhook æ”¯æŒ**
   - åˆ›å»ºäº‘é›¾ webhook æ¥æ”¶ç«¯ç‚¹
   - å¤„ç†ä»»åŠ¡å®Œæˆå›è°ƒ
   - å‡å°‘è½®è¯¢é¢‘ç‡ï¼Œæå‡æ€§èƒ½

3. **æ•°æ®åº“ä¼˜åŒ–**
   - æ›´æ–° `effect` è¡¨ï¼Œæ·»åŠ  Seedream å’Œ Nano Banana æ¨¡å‹è®°å½•
   - è®¾ç½®æ­£ç¡®çš„ credit æ¶ˆè€—å€¼
   - æ¸…ç†æ—§çš„ Replicate ç›¸å…³é…ç½®

### ä¼˜å…ˆçº§ 2: ç”¨æˆ·ä½“éªŒ
1. **å†å²è®°å½•é¡µé¢**
   - å±•ç¤ºç”¨æˆ·ç”Ÿæˆå†å²
   - æ”¯æŒæŸ¥çœ‹å’Œä¸‹è½½å†å²å›¾ç‰‡
   - ç§¯åˆ†æ¶ˆè€—è®°å½•

2. **é”™è¯¯å¤„ç†å¢å¼º**
   - æ›´è¯¦ç»†çš„é”™è¯¯æç¤º
   - å¤±è´¥è‡ªåŠ¨é‡è¯•æœºåˆ¶
   - ç§¯åˆ†é€€è¿˜ï¼ˆç”Ÿæˆå¤±è´¥æ—¶ï¼‰

3. **æ€§èƒ½ä¼˜åŒ–**
   - å›¾ç‰‡æ‡’åŠ è½½
   - ç¼©ç•¥å›¾é¢„è§ˆ
   - è¯·æ±‚å»é‡å’Œç¼“å­˜

### ä¼˜å…ˆçº§ 3: åŠŸèƒ½æ‰©å±•
1. **æ›´å¤š AI æ¨¡å‹**
   - æ ¹æ®éœ€æ±‚æ¥å…¥å…¶ä»–æ¨¡å‹
   - æ¨¡å‹èƒ½åŠ›å¯¹æ¯”å±•ç¤º

2. **æ‰¹é‡ç”Ÿæˆ**
   - æ”¯æŒä¸€æ¬¡æäº¤å¤šä¸ª prompt
   - é˜Ÿåˆ—ç®¡ç†

3. **é«˜çº§å‚æ•°**
   - Seedream custom size (width/height)
   - æ›´å¤šé£æ ¼é€‰é¡¹

## ğŸ“ å¾…åŠäº‹é¡¹

- [ ] æµ‹è¯•æ‰€æœ‰ 4 ç§ç”Ÿæˆæ¨¡å¼
- [ ] å®ç° R2 å­˜å‚¨ä¸Šä¼ 
- [ ] åˆ›å»º webhook æ¥æ”¶ç«¯ç‚¹
- [ ] æ›´æ–°æ•°æ®åº“ effect è¡¨
- [ ] æ·»åŠ  fal.media åˆ° next.config.mjs å›¾ç‰‡åŸŸåç™½åå•
- [ ] åˆ›å»ºå†å²è®°å½•é¡µé¢
- [ ] ç¼–å†™ API æ–‡æ¡£
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæµ‹è¯•

## ğŸ’¡ æŠ€æœ¯å€ºåŠ¡

1. æ¸…ç†æ—§çš„ KIE.AI ç›¸å…³ä»£ç å’Œæ–‡ä»¶
2. ç§»é™¤æœªä½¿ç”¨çš„ Replicate API ä»£ç 
3. ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. æ·»åŠ å•å…ƒæµ‹è¯•
